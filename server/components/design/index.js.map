{"version":3,"sources":["components/design/index.js"],"names":["_","require","fs","path","config","design","manager","getAreas","cb","encuadres","err","areas","result","map","a","encode","kebabCase","area","replace","alt","file","cover","filter","client","env","existsSync","join","root","push","areaByName","name","find","undefined","ejes","axis","bloques","eje","imgFolder","defaultImg","e","encodeArea","encodeAx","sub","blocks","b","encodeBlock","relative","full","img","transversales","trans","item","module","exports"],"mappings":";AACA;;AAEA,IAAIA,IAAIC,QAAQ,QAAR,CAAR;AACA,IAAIC,KAAKD,QAAQ,IAAR,CAAT;AACA,IAAIE,OAAOF,QAAQ,MAAR,CAAX;;AAEA,IAAIG,SAASH,QAAQ,0BAAR,CAAb;;AAEA,IAAII,SAAS,EAAb;;AAEAA,OAAOC,OAAP,GAAiBL,QAAQ,WAAR,CAAjB;;AAEA,IAAIM,WAAW,SAAXA,QAAW,CAASC,EAAT,EAAY;AACzB,SAAOA,GAAG,IAAH,EAASP,QAAQ,cAAR,CAAT,CAAP;AACD,CAFD;;AAIAI,OAAOI,SAAP,GAAmB,UAASD,EAAT,EAAY;;AAE7BD,WAAS,UAASG,GAAT,EAAcC,KAAd,EAAoB;AAC3B,QAAIC,SAASD,MAAME,GAAN,CAAU,UAASC,CAAT,EAAW;AAClC,UAAIC,SAASf,EAAEgB,SAAF,CAAYF,EAAEG,IAAd,EAAoBC,OAApB,CAA4B,MAA5B,EAAoC,GAApC,CAAb;AACE,aAAO;AACLD,cAAMH,EAAEG,IADH;AAELE,aAAK,mBAAmBL,EAAEG,IAFrB;AAGLG,cAAM,sCAAsCL,MAAtC,GAA+C,MAHhD;AAILM,eAAO,uBAAuBN,MAAvB,GAAgC;AAJlC,OAAP;AAMD,KARY,CAAb;;AAUA,QAAIN,YAAYG,OAAOU,MAAP,CAAc,UAASR,CAAT,EAAW;AACvC,UAAIS,SAASnB,OAAOoB,GAAP,KAAe,YAAf,GAA8B,QAA9B,GAAyC,QAAtD;AACA,aAAOtB,GAAGuB,UAAH,CAActB,KAAKuB,IAAL,CAAUtB,OAAOuB,IAAjB,EAAuBJ,MAAvB,EAA+BT,EAAEM,IAAjC,CAAd,CAAP;AACD,KAHe,CAAhB;;AAKAX,cAAUmB,IAAV,CAAe;AACbX,YAAM,eADO;AAEbE,WAAK,6BAFQ;AAGbC,YAAM,gDAHO;AAIbC,aAAO;AAJM,KAAf;;AAOAb,OAAG,IAAH,EAASC,SAAT;AACD,GAxBD;AA0BD,CA5BD;;AA8BAJ,OAAOwB,UAAP,GAAoB,UAASC,IAAT,EAAetB,EAAf,EAAkB;;AAEpCH,SAAOC,OAAP,CAAeK,KAAf,CAAqB,KAArB,EAA4B,UAASD,GAAT,EAAcC,KAAd,EAAoB;AAC9C,QAAIG,IAAId,EAAE+B,IAAF,CAAOpB,KAAP,EAAc,EAAEmB,MAAMA,IAAR,EAAd,CAAR;AACA,QAAIhB,MAAMkB,SAAV,EAAoB;AAClB,aAAOxB,MAAMA,GAAG,IAAH,EAAS,EAAT,CAAb;AACD;;AAEDA,OAAG,IAAH,EAASM,CAAT;AACD,GAPD;AASD,CAXD;;AAaAT,OAAO4B,IAAP,GAAc,UAAShB,IAAT,EAAeT,EAAf,EAAkB;;AAE9BH,SAAOC,OAAP,CAAeK,KAAf,CAAqB,KAArB,EAA4B,UAASD,GAAT,EAAcC,KAAd,EAAoB;AAC9C,QAAIG,IAAId,EAAE+B,IAAF,CAAOpB,KAAP,EAAc,EAAEmB,MAAMb,IAAR,EAAd,CAAR;AACA,QAAIH,MAAMkB,SAAV,EAAoB;AAClB,aAAOxB,MAAMA,GAAG,IAAH,EAAS,EAAT,CAAb;AACD;;AAEDA,OAAG,IAAH,EAASM,EAAEoB,IAAX;AACD,GAPD;AASD,CAXD;;AAaA7B,OAAO8B,OAAP,GAAiB,UAASlB,IAAT,EAAemB,GAAf,EAAoB5B,EAApB,EAAuB;;AAEtC,MAAIe,SAASnB,OAAOoB,GAAP,KAAe,YAAf,GAA8B,QAA9B,GAAyC,QAAtD;AACA,MAAIa,YAAYlC,KAAKuB,IAAL,CAAUtB,OAAOuB,IAAjB,EAAuBJ,MAAvB,CAAhB;AACA,MAAIe,aAAa,+BAAjB;;AAEA/B,WAAS,UAASG,GAAT,EAAcC,KAAd,EAAoB;AAC3B,QAAIG,IAAId,EAAE+B,IAAF,CAAOpB,KAAP,EAAc,EAAEM,MAAMA,IAAR,EAAd,CAAR;AACA,QAAIsB,IAAIvC,EAAE+B,IAAF,CAAOjB,EAAEoB,IAAT,EAAe,EAAEJ,MAAMM,GAAR,EAAf,CAAR;AACA,QAAIG,MAAMP,SAAV,EAAqB;AACnB,aAAOxB,MAAMA,GAAG,IAAH,EAAS,EAAT,CAAb;AACD;AACD,QAAIgC,aAAaxC,EAAEgB,SAAF,CAAYC,IAAZ,EAAkBC,OAAlB,CAA0B,MAA1B,EAAkC,GAAlC,CAAjB;AACA,QAAIuB,WAAWzC,EAAEgB,SAAF,CAAYoB,GAAZ,EAAiBlB,OAAjB,CAAyB,MAAzB,EAAiC,GAAjC,CAAf;AACA,QAAIwB,MAAM,oBAAV;;AAEA,QAAIC,SAASJ,EAAEI,MAAF,CAAS9B,GAAT,CAAa,UAAS+B,CAAT,EAAW;AACnC,UAAIC,cAAc7C,EAAEgB,SAAF,CAAY4B,CAAZ,EAAe1B,OAAf,CAAuB,MAAvB,EAA+B,GAA/B,CAAlB;AACA,UAAI4B,WAAW3C,KAAKuB,IAAL,CAAU,oBAAV,EAAgCc,UAAhC,EAA4CC,QAA5C,EAAsDI,WAAtD,EAAmE,aAAnE,CAAf;AACA,UAAIE,OAAO5C,KAAKuB,IAAL,CAAUW,SAAV,EAAqBS,QAArB,CAAX;AACA,UAAIE,MAAM9C,GAAGuB,UAAH,CAAcsB,IAAd,IAAsBD,SAAS5B,OAAT,CAAiB,MAAjB,EAAyB,GAAzB,CAAtB,GAAsDoB,UAAhE;;AAEA,aAAO;AACLrB,cAAMA,IADD;AAELmB,aAAKA,GAFA;AAGLN,cAAMc,CAHD;AAILI,aAAKA,GAJA;AAKLD,cAAMA;AALD,OAAP;AAOD,KAbY,CAAb;;AAeAvC,OAAG,IAAH,EAASmC,MAAT;AACD,GA1BD;AA4BD,CAlCD;;AAoCAtC,OAAO4C,aAAP,GAAuB,UAASzC,EAAT,EAAY;;AAEjCH,SAAOC,OAAP,CAAeK,KAAf,CAAqB,KAArB,EAA4B,UAASD,GAAT,EAAcC,KAAd,EAAoB;AAC9C,QAAIuC,QAAQlD,EAAEsB,MAAF,CAASX,KAAT,EAAgB,UAASwC,IAAT,EAAc;AACxC,aAAOA,KAAKrB,IAAL,KAAc,gCAAd,IAAkDqB,KAAKrB,IAAL,KAAc,oCAAvE;AACD,KAFW,CAAZ;;AAIA,QAAIoB,UAAUlB,SAAd,EAAwB;AACtB,aAAOxB,MAAMA,GAAG,IAAH,EAAS,EAAT,CAAb;AACD;;AAEDA,OAAG,IAAH,EAAS0C,KAAT;AACD,GAVD;AAYD,CAdD;;AAgBAE,OAAOC,OAAP,GAAiBhD,MAAjB","file":"index.js","sourcesContent":["\n'use strict';\n\nvar _ = require('lodash');\nvar fs = require('fs');\nvar path = require('path');\n\nvar config = require('../../config/environment');\n\nvar design = {};\n\ndesign.manager = require('./manager');\n\nvar getAreas = function(cb){\n  return cb(null, require('./areas.json'))\n};\n\ndesign.encuadres = function(cb){\n\n  getAreas(function(err, areas){\n    var result = areas.map(function(a){\n    var encode = _.kebabCase(a.area).replace(/\\-/ig, '_')\n      return { \n        area: a.area,\n        alt: 'Encuadre para ' + a.area,\n        file: '/assets/files/encuadres/encuadre_' + encode + '.pdf',\n        cover: '/assets/img/areas/' + encode + '/encuadre.png'\n      };\n    });\n\n    var encuadres = result.filter(function(a){\n      var client = config.env === 'production' ? 'public' : 'client';\n      return fs.existsSync(path.join(config.root, client, a.file));\n    });\n\n    encuadres.push({\n      area: 'Ed. Artística',\n      alt: 'Encuadre para Ed. Artística',\n      file: '/assets/files/encuadres/encuadre_artistica.pdf',\n      cover: '/assets/img/areas/artistica/encuadre.png'\n    });\n    \n    cb(null, encuadres);\n  });\n\n};\n\ndesign.areaByName = function(name, cb){\n\n  design.manager.areas(false, function(err, areas){\n    var a = _.find(areas, { name: name });\n    if (a === undefined){\n      return cb && cb(null, []);\n    }\n\n    cb(null, a);\n  });\n\n};\n\ndesign.ejes = function(area, cb){\n\n  design.manager.areas(false, function(err, areas){\n    var a = _.find(areas, { name: area });\n    if (a === undefined){\n      return cb && cb(null, []);\n    }\n\n    cb(null, a.axis);\n  });\n\n};\n\ndesign.bloques = function(area, eje, cb){\n  \n  var client = config.env === 'production' ? 'public' : 'client';\n  var imgFolder = path.join(config.root, client);\n  var defaultImg = '/assets/img/areas/portada.png'\n\n  getAreas(function(err, areas){\n    var a = _.find(areas, { area: area });\n    var e = _.find(a.axis, { name: eje });\n    if (e === undefined) {\n      return cb && cb(null, []);\n    }\n    var encodeArea = _.kebabCase(area).replace(/\\-/ig, '_');\n    var encodeAx = _.kebabCase(eje).replace(/\\-/ig, '_');\n    var sub = '/assets/img/areas/'\n\n    var blocks = e.blocks.map(function(b){\n      var encodeBlock = _.kebabCase(b).replace(/\\-/ig, '_');\n      var relative = path.join('/assets/img/areas/', encodeArea, encodeAx, encodeBlock, 'portada.png');\n      var full = path.join(imgFolder, relative);\n      var img = fs.existsSync(full) ? relative.replace(/\\\\/ig, '/') : defaultImg;\n\n      return {\n        area: area,\n        eje: eje,\n        name: b,\n        img: img,\n        full: full,\n      };\n    });\n\n    cb(null, blocks);\n  });\n\n};\n\ndesign.transversales = function(cb){\n\n  design.manager.areas(false, function(err, areas){\n    var trans = _.filter(areas, function(item){\n      return item.name === \"Equipos de Orientación Escolar\" || item.name === \"Centros Educativos Complementarios\";\n    });\n\n    if (trans === undefined){\n      return cb && cb(null, []);\n    }\n\n    cb(null, trans);\n  });\n\n};\n\nmodule.exports = design;"]}