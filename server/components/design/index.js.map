{"version":3,"sources":["components/design/index.js"],"names":["_","require","fs","path","config","design","manager","getAreas","cb","filename","join","__dirname","exists","readFile","err","content","areas","JSON","parse","encuadres","result","map","a","encode","kebabCase","area","replace","alt","file","cover","filter","client","env","existsSync","root","push","areaByName","name","find","undefined","ejes","axis","bloques","eje","imgFolder","defaultImg","e","encodeArea","encodeAx","sub","blocks","b","encodeBlock","relative","full","img","transversales","trans","item","module","exports"],"mappings":"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","file":"index.js","sourcesContent":["\n'use strict';\n\nvar _ = require('lodash');\nvar fs = require('fs');\nvar path = require('path');\n\nvar config = require('../../config/environment');\n\nvar design = {};\n\ndesign.manager = require('./manager');\n\nvar getAreas = function(cb){\n  var filename = path.join(__dirname, 'areas.json');\n\n  fs.exists(filename, function(exists){\n    \n    if (exists) {\n      fs.readFile(filename, 'utf-8', function(err, content){\n        if (err) { return cb && cb(err); }\n        \n        var areas = JSON.parse(content).areas;\n\n        cb (null, areas);\n      });\n    } else {\n      cb(null, []);\n    }\n\n  });\n};\n\ndesign.encuadres = function(cb){\n\n  getAreas(function(err, areas){\n    var result = areas.map(function(a){\n    var encode = _.kebabCase(a.area).replace(/\\-/ig, '_')\n      return { \n        area: a.area,\n        alt: 'Encuadre para ' + a.area,\n        file: '/assets/files/encuadres/encuadre_' + encode + '.pdf',\n        cover: '/assets/img/areas/' + encode + '/encuadre.png'\n      };\n    });\n\n    var encuadres = result.filter(function(a){\n      var client = config.env === 'production' ? 'public' : 'client';\n      return fs.existsSync(path.join(config.root, client, a.file));\n    });\n\n    encuadres.push({\n      area: 'Ed. Artística',\n      alt: 'Encuadre para Ed. Artística',\n      file: '/assets/files/encuadres/encuadre_artistica.pdf',\n      cover: '/assets/img/areas/artistica/encuadre.png'\n    });\n    \n    cb(null, encuadres);\n  });\n\n};\n\ndesign.areaByName = function(name, cb){\n\n  design.manager.areas(false, function(err, areas){\n    var a = _.find(areas, { name: name });\n    if (a === undefined){\n      return cb && cb(null, []);\n    }\n\n    cb(null, a);\n  });\n\n};\n\ndesign.ejes = function(area, cb){\n\n  design.manager.areas(false, function(err, areas){\n    var a = _.find(areas, { name: area });\n    if (a === undefined){\n      return cb && cb(null, []);\n    }\n\n    cb(null, a.axis);\n  });\n\n};\n\ndesign.bloques = function(area, eje, cb){\n  \n  var client = config.env === 'production' ? 'public' : 'client';\n  var imgFolder = path.join(config.root, client);\n  var defaultImg = '/assets/img/areas/portada.png'\n\n  getAreas(function(err, areas){\n    var a = _.find(areas, { area: area });\n    var e = _.find(a.axis, { name: eje });\n    if (e === undefined) {\n      return cb && cb(null, []);\n    }\n    var encodeArea = _.kebabCase(area).replace(/\\-/ig, '_');\n    var encodeAx = _.kebabCase(eje).replace(/\\-/ig, '_');\n    var sub = '/assets/img/areas/'\n\n    var blocks = e.blocks.map(function(b){\n      var encodeBlock = _.kebabCase(b).replace(/\\-/ig, '_');\n      var relative = path.join('/assets/img/areas/', encodeArea, encodeAx, encodeBlock, 'portada.png');\n      var full = path.join(imgFolder, relative);\n      var img = fs.existsSync(full) ? relative.replace(/\\\\/ig, '/') : defaultImg;\n\n      return {\n        area: area,\n        eje: eje,\n        name: b,\n        img: img,\n        full: full,\n      };\n    });\n\n    cb(null, blocks);\n  });\n\n};\n\ndesign.transversales = function(cb){\n\n  design.manager.areas(false, function(err, areas){\n    var trans = _.filter(areas, function(item){\n      return item.name === \"Equipos de Orientación Escolar\" || item.name === \"Centros Educativos Complementarios\";\n    });\n\n    if (trans === undefined){\n      return cb && cb(null, []);\n    }\n\n    cb(null, trans);\n  });\n\n};\n\nmodule.exports = design;"]}