{"version":3,"sources":["components/design/manager.js"],"names":["_","require","fs","path","config","manager","_areas","client","imgFolder","join","root","defaultImg","rootUrl","getAreas","force","cb","filename","__dirname","exists","readFile","err","content","areas","JSON","parse","createStructure","mapAreas","undefined","length","res","map","item","encodeArea","kebabCase","area","replace","relative","full","img","existsSync","a","name","shortname","kebadCase","subareas","axis","ax","encodeAx","rax","blocks","b","encodeBlock","relativeb","fullb","imgb","rb","fullpath","module","exports"],"mappings":"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","file":"components/design/manager.js","sourcesContent":["\n'use strict';\n\nvar _ = require('lodash');\nvar fs = require('fs');\nvar path = require('path');\n\nvar config = require('../../config/environment');\n\nvar manager = {};\nvar _areas;\n\nvar client = 'client'; //config.env === 'production' ? 'public' : 'client';\nvar imgFolder = path.join(config.root, client);\nvar defaultImg = '/assets/img/areas/portada.png';\nvar rootUrl = '/assets/img/areas/';\n\nvar getAreas = function(force, cb){\n  \n  if (typeof force === 'function'){\n    cb = force;\n    force = false;\n  }\n\n  /*if (_areas !== undefined && !force){\n    return cb && cb(null, _areas);\n  }*/\n\n  var filename = path.join(__dirname, 'areas.json');\n\n  fs.exists(filename, function(exists){\n    \n    if (exists) {\n      fs.readFile(filename, 'utf-8', function(err, content){\n        if (err) { return cb && cb(err); }\n        \n        var areas = JSON.parse(content).areas;\n        _areas = areas;\n        cb (null, areas);\n      });\n    } else {\n      cb(null, []);\n    }\n\n  });\n};\n\n// TODO: generate cache\nfunction createStructure(force, cb){\n  getAreas(force, function(err, areas){\n    if (err){\n      return cb(err);\n    }\n\n    cb(null, mapAreas(areas));\n  });\n}\n\nfunction mapAreas(areas){\n  \n  if (areas === undefined || areas.length === 0) {\n    return [];\n  }\n\n  var res = areas.map(function(item){\n    var encodeArea = _.kebabCase(item.area).replace(/\\-/ig, '_');\n  \n    var relative = path.join(rootUrl, encodeArea, 'padnet.png');\n    var full = path.join(imgFolder, relative);\n    var img = fs.existsSync(full) ? relative.replace(/\\\\/ig, '/') : defaultImg;\n\n    var a = {\n      name: item.area,\n      shortname: item.shortname,\n      kebadCase: encodeArea,\n      img: img,\n      subareas: mapAreas(item.subareas)\n    };\n\n    a.axis = item.axis.map(function(ax){\n      var encodeAx = _.kebabCase(ax.name).replace(/\\-/ig, '_');\n      var relative = path.join(rootUrl, a.kebadCase, encodeAx, 'padnet.png');\n      var full = path.join(imgFolder, relative);\n      var img = fs.existsSync(full) ? relative.replace(/\\\\/ig, '/') : defaultImg;\n\n      var rax = {\n        name: ax.name,\n        kebadCase: encodeAx,\n        img: img,\n        //fullpath: full\n      };\n\n      rax.blocks = ax.blocks.map(function(b){\n        \n        var encodeBlock = _.kebabCase(b).replace(/\\-/ig, '_');\n        var relativeb = path.join(rootUrl, a.kebadCase, rax.kebadCase, encodeBlock, 'portada.png');\n        var fullb = path.join(imgFolder, relativeb);\n        var imgb = fs.existsSync(fullb) ? relativeb.replace(/\\\\/ig, '/') : defaultImg;\n\n        var rb = {\n          name: b,\n          kebadCase: encodeBlock,\n          img: imgb,\n          fullpath: fullb,\n        };\n\n        return rb;\n      });\n\n      return rax;\n    });\n\n    return a;\n\n  });\n\n  return res;\n}\n\nmanager.areas = function(force, cb){\n  createStructure(force, cb);\n};\n\nmodule.exports = manager;"],"sourceRoot":"/source/"}