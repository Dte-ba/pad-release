{"version":3,"sources":["components/epm-rest/content.js"],"names":["fs","require","express","serveIndex","mime","path","_","open","Log","log","manager","module","exports","router","get","req","res","next","rname","params","repository","uid","debug","progress","info","fail","err","done","repo","findOne","pkg","build","filename","engine","content","data","files","map","f","process","platform","replace","stats","statSync","resolve","thefiles","type","writeResolved","route","p","cacheContent","undefined","to","redirect","url","dfn","apply","decodeURIComponent","join","stat","code","isDirectory","options","root","headers","Date","now","sendFile","console","status","end","writeError","error","statusCode","setHeader","writeHead","json","fname","basename","encodeURIComponent","lookup","length","bpath","extractBasepath","relfiles","htmls","filter","rf","test","ihtml","h","idxhtml","index","r","item","uri","entries","dirs","e","dirname","sdirs","d","split","idx","curr","eq","haveFunc","sd","eqFunc","i","eqmapFunc","a","have","all"],"mappings":"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","file":"content.js","sourcesContent":["'use strict';\n\nvar fs  = require('fs');\nvar express = require('express');\nvar serveIndex = require('serve-index');\nvar mime = require('mime');\nvar path = require('path');\nvar _ = require('lodash');\nvar open = require('open');\n\nvar Log = require('log')\n  , log = new Log('info');\n\nvar manager = require('../epm-manager');\n\nmodule.exports = function(router){\n  \n  router.get('/content/:repository/:uid', function(req, res, next){\n    var rname = req.params.repository;\n    var uid = req.params.uid;\n\n    log.debug('/content/:repository/:uid');\n\n    manager\n      .get(rname)\n      .progress(function(info){\n\n      })\n      .fail(function(err){\n        next(err);\n      })\n      .done(function(repo){\n\n        repo\n        .findOne({uid: uid}, function(err, pkg){\n          if (err) {\n            return next(err);\n          }\n          var info = {\n            uid: uid,\n            build: pkg.build || 1,\n            filename: pkg.filename    \n          };\n\n          repo\n            .engine\n            .content(repo, info, pkg)\n            .fail(function(err){\n              next(err);\n            })\n            .done(function(data){\n              var files = data.map(function(f){ \n                if (process.platform !== 'win32') {\n                  f = f.replace(/\\\\/ig, '/');\n                } else {\n                  f = f.replace(/\\//ig, '\\\\');\n                }\n\n                return {\n                  filename: f,\n                  stats: fs.statSync(path.resolve(f))\n                }\n              });\n\n              var thefiles = {\n                uid: uid,\n                type: 'files',\n                files: files\n              };\n\n              writeResolved(thefiles, res, rname);\n            });\n              \n        });\n      });\n\n  });\n\n  router.get('/files/:repository/:uid', function(req, res, next){\n    var rname = req.params.repository;\n    var uid = req.params.uid;\n\n    log.debug('/files/:repository/:uid');\n\n    var route = '/files/' + rname + '/' + uid;\n\n    var p = router.cacheContent[route];\n    \n    if (p === undefined) {\n      log.debug('the route is not %s cached', route);\n      var to = '/epm/content/' + rname + '/' + uid;\n      log.debug('redirect to %s', to);\n      return res.redirect(to);\n    }\n\n    log.debug('indexing %s', route);\n\n    req.url = req.url.replace(route, '/');\n\n    var dfn = serveIndex(p.path, {'icons': true});\n    \n    dfn.apply(router, [req, res, next]);\n  });\n\n  router.get('/files/:repository/:uid/*', function(req, res, next){\n    var rname = req.params.repository;\n    var uid = req.params.uid;\n\n    log.debug('/files/:repository/:uid/*');\n\n    var route = '/files/' + rname + '/' + uid;\n\n    var p = router.cacheContent[route];\n    \n    if (p === undefined) {\n      log.debug('the route is not %s cached', route);\n      var to = '/epm/content/' + rname + '/' + uid;\n      log.debug('redirect to %s', to);\n      return res.redirect(to);\n    }\n\n    req.url = req.url.replace(route, '');\n\n    var filename = decodeURIComponent(path.join(p.path, req.url));\n\n    fs.stat(filename, function(err, stat){\n      if (err) {\n        return 'ENOENT' === err.code ? next() : next(err);\n      }\n\n      if (stat.isDirectory()){\n        log.debug('indexing %s', filename);\n        var dfn = serveIndex(filename, { 'icons': true });\n        dfn.apply(router, [req, res, next]);\n        return;\n      }\n\n      log.debug('sending file: %s', filename);\n      //log.debug(p);\n      \n      //res.sendFile(filename);\n      var options = {\n        root: p.path,\n        //dotfiles: 'deny',\n        headers: {\n            'x-timestamp': Date.now(),\n            'x-sent': true\n        }\n      };\n\n      res.sendFile(filename.replace(p.path, ''), options, function (err) {\n        if (err) {\n          console.log(err);\n          res.status(err.status).end();\n        }\n        else {\n          //console.log('Sent:', filename);\n        }\n      });\n\n    });\n\n  });\n\n  return router;\n\n  function writeError(error, res, statusCode){\n    statusCode = statusCode || 500;\n    res.setHeader('Content-Type', 'application/json');\n    res.writeHead(statusCode);\n    return res.json(error);\n  }\n\n  function sendFile(res, filename){\n    var fname = path.basename(filename);\n    fname = encodeURIComponent(fname);\n    res.setHeader('Content-disposition', 'inline; filename=\"' + fname + '\"');\n    res.setHeader('Content-Type', mime.lookup(filename));\n\n    res.sendFile(filename);\n  }\n\n  /**\n   * Write epm-pad-engine resutls\n   */\n  function writeResolved(info, res, rname, statusCode){\n    \n    statusCode = statusCode || 200;\n    if (info.files.length === 1){\n      \n      //for desktop applications\n      //if (process.env.PAD_MODE === 'desktop') {\n      //  try {\n      //    //console.log('trying open with NW_GUI');\n      //    //gui.Shell.openItem(info.files[0].filename);\n      //    open(info.files[0].filename);\n      //    return true;\n      //  } catch(ex){\n      //    console.log(ex);\n      //  }\n      //}\n\n      // if has error download\n      sendFile(res, info.files[0].filename);\n      return true;\n    } else {\n      var bpath = extractBasepath(info.files.map(function(f){ return f.filename; }));\n      \n      var relfiles = info.files.map(function(f){\n        var fname = f.filename.replace(/\\\\/ig, '/');\n        return fname.replace(bpath, '');\n      });\n\n      var htmls = relfiles.filter(function(rf){\n        return (/\\.html$/i).test(rf);\n      });\n\n      // the index HTML\n      var ihtml = htmls.filter(function(h){ \n        return /index.htm(l)?/ig.test(h);\n      });\n\n      var idxhtml = ihtml.length > 0 ? ihtml[0] : undefined;\n\n      if ( idxhtml === undefined){\n        // index.html doesn't exists \n        // any html\n        idxhtml = (htmls.length > 0 ? htmls[0] : undefined);\n        idxhtml = idxhtml.replace(bpath, '');\n      }\n\n      var route = '/files/' + rname + '/' + info.uid;\n      if (router.cacheContent[route] === undefined){\n        router.cacheContent[route] = {\n          path: bpath,\n          index: idxhtml\n        };\n      }\n      var r = route;\n      \n      var item = router.cacheContent[route];\n      if (item.index !== undefined){\n        r += '/' + item.index;\n      }\n      var uri = '/epm' + r;\n      log.debug('writeResolved: redirect to %s', uri);\n      \n      res.redirect(uri);\n      return true;\n    }\n\n    function extractBasepath(entries) {\n\n      var dirs = entries.map(function(e){ \n        return path.dirname(e); \n      });\n\n      var sdirs = dirs.map(function(d){ \n        \n        if (process.platform !== 'win32') {\n          return d.split(/\\//i);\n        } else {\n          return d.split(/\\\\/i);\n        }\n      });\n\n      var idx = 0;\n      var curr;\n      var root = '';\n      var eq;\n\n      var haveFunc = function(sd){ \n        return sd.length > idx; \n      };\n\n      var eqFunc = function(i){\n        return curr === i;\n      };\n\n      var eqmapFunc = function(a){ \n        return a[idx]; \n      };\n\n      do {\n\n        curr = sdirs[0][idx];\n\n        var have = _.all(sdirs, haveFunc);\n\n        eq = have;\n        if (have === true){\n          eq = _.all(sdirs.map(eqmapFunc), eqFunc);\n        }\n\n        if(eq) {\n          root += curr + '/';\n        }\n\n        idx++;\n\n      } while(eq === true);\n\n      return root;\n    }\n  }\n};\n\n"]}