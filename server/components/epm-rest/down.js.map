{"version":3,"sources":["components/epm-rest/down.js"],"names":["path","require","mime","manager","module","exports","req","res","next","rname","params","repository","uid","get","progress","info","fail","err","done","repo","findOne","pkg","fname","filename","encodeURIComponent","setHeader","lookup","sendFile","resolve"],"mappings":"AAAA;;AAEA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;AACA,IAAIC,OAAOD,QAAQ,MAAR,CAAX;;AAEA,IAAIE,UAAUF,QAAQ,gBAAR,CAAd;;AAEAG,OAAOC,OAAP,GAAkB,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAwB;AACxC,MAAIC,QAAQH,IAAII,MAAJ,CAAWC,UAAvB;AACA,MAAIC,MAAMN,IAAII,MAAJ,CAAWE,GAArB;;AAEAT,UACGU,GADH,CACOJ,KADP,EAEGK,QAFH,CAEY,UAASC,IAAT,EAAc,CAEvB,CAJH,EAKGC,IALH,CAKQ,UAASC,GAAT,EAAa;AACjBT,SAAKS,GAAL;AACD,GAPH,EAQGC,IARH,CAQQ,UAASC,IAAT,EAAc;;AAElBA,SACCC,OADD,CACS,EAACR,KAAKA,GAAN,EADT,EACqB,UAASK,GAAT,EAAcI,GAAd,EAAkB;AACrC,UAAIJ,GAAJ,EAAS;AACP,eAAOT,KAAKS,GAAL,CAAP;AACD;AACD,UAAIK,QAAQD,IAAIE,QAAhB;AACAD,cAAQE,mBAAmBF,KAAnB,CAAR;AACAf,UAAIkB,SAAJ,CAAc,qBAAd,EAAqC,uBAAuBH,KAAvB,GAA+B,GAApE;AACAf,UAAIkB,SAAJ,CAAc,cAAd,EAA8BvB,KAAKwB,MAAL,CAAYL,IAAIE,QAAhB,CAA9B;;AAEAhB,UAAIoB,QAAJ,CAAaR,KAAKS,OAAL,CAAaP,IAAIE,QAAjB,CAAb;AACD,KAXD;AAYD,GAtBH;AAwBD,CA5BD","file":"down.js","sourcesContent":["'use strict';\n\nvar path = require('path');\nvar mime = require('mime');\n\nvar manager = require('../epm-manager');\n\nmodule.exports =  function(req, res, next){\n  var rname = req.params.repository;\n  var uid = req.params.uid;\n  \n  manager\n    .get(rname)\n    .progress(function(info){\n\n    })\n    .fail(function(err){\n      next(err);\n    })\n    .done(function(repo){\n\n      repo\n      .findOne({uid: uid}, function(err, pkg){\n        if (err) {\n          return next(err);\n        }\n        var fname = pkg.filename;\n        fname = encodeURIComponent(fname);\n        res.setHeader('Content-disposition', 'inline; filename=\"' + fname + '\"');\n        res.setHeader('Content-Type', mime.lookup(pkg.filename));\n\n        res.sendFile(repo.resolve(pkg.filename));\n      });\n    });\n\n};"]}