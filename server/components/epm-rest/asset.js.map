{"version":3,"sources":["components/epm-rest/asset.js"],"names":["path","require","manager","module","exports","req","res","next","rname","params","repository","uid","asset","type","name","get","progress","info","fail","err","done","repo","findOne","pkg","console","log","build","filename","engine","options","root","dirname","dotfiles","headers","Date","now","sendFile"],"mappings":"AAAA;;AAEA,IAAIA,OAAOC,QAAQ,MAAR,CAAX;;AAEA,IAAIC,UAAUD,QAAQ,gBAAR,CAAd;;AAEAE,OAAOC,OAAP,GAAkB,UAASC,GAAT,EAAcC,GAAd,EAAmBC,IAAnB,EAAwB;;AAExC,MAAIC,QAAQH,IAAII,MAAJ,CAAWC,UAAvB;AACA,MAAIC,MAAMN,IAAII,MAAJ,CAAWE,GAArB;AACA,MAAIC,QAAQP,IAAII,MAAJ,CAAWG,KAAvB;AACA,MAAIC,OAAOR,IAAII,MAAJ,CAAWI,IAAtB;AACA,MAAIC,OAAOT,IAAII,MAAJ,CAAWK,IAAtB;;AAEAZ,UACGa,GADH,CACOP,KADP,EAEGQ,QAFH,CAEY,UAASC,IAAT,EAAc,CAEvB,CAJH,EAKGC,IALH,CAKQ,UAASC,GAAT,EAAa;AACjBZ,SAAKY,GAAL;AACD,GAPH,EAQGC,IARH,CAQQ,UAASC,IAAT,EAAc;AAClBA,SACGC,OADH,CACW,EAACX,KAAKA,GAAN,EADX,EACuB,UAASQ,GAAT,EAAcI,GAAd,EAAkB;;AAErC,UAAIJ,GAAJ,EAAQ;AACNK,gBAAQC,GAAR,CAAYN,GAAZ;AACD;AACD,UAAIF,OAAO;AACTN,aAAKA,GADI;AAETe,eAAOH,IAAIG,KAAJ,IAAa,CAFX;AAGTC,kBAAUJ,IAAII;AAHL,OAAX;;AAMAN,WACGO,MADH,CAEGhB,KAFH,CAESS,IAFT,EAEeJ,IAFf,EAEqBM,GAFrB,EAE0BT,IAF1B,EAGGI,IAHH,CAGQ,UAASC,GAAT,EAAa;AACjBZ,aAAKY,GAAL;AACD,OALH,EAMGC,IANH,CAMQ,UAASO,QAAT,EAAkB;AACtB,YAAIE,UAAU;AACZC,gBAAM9B,KAAK+B,OAAL,CAAaJ,QAAb,CADM;AAEZK,oBAAU,MAFE;AAGZC,mBAAS;AACL,2BAAeC,KAAKC,GAAL,EADV;AAEL,sBAAU;AAFL;AAHG,SAAd;;AASA7B,YAAI8B,QAAJ,CAAaT,QAAb;AACD,OAjBH;AAkBD,KA9BH;AA+BD,GAxCH;AA0CD,CAlDD","file":"asset.js","sourcesContent":["'use strict';\n\nvar path = require('path');\n\nvar manager = require('../epm-manager');\n\nmodule.exports =  function(req, res, next){\n\n  var rname = req.params.repository;\n  var uid = req.params.uid;\n  var asset = req.params.asset;\n  var type = req.params.type;\n  var name = req.params.name;\n\n  manager\n    .get(rname)\n    .progress(function(info){\n\n    })\n    .fail(function(err){\n      next(err);\n    })\n    .done(function(repo){\n      repo\n        .findOne({uid: uid}, function(err, pkg){\n\n          if (err){\n            console.log(err);\n          }\n          var info = {\n            uid: uid,\n            build: pkg.build || 1,\n            filename: pkg.filename    \n          };\n\n          repo\n            .engine\n            .asset(repo, info, pkg, name)\n            .fail(function(err){\n              next(err);\n            })\n            .done(function(filename){\n              var options = {\n                root: path.dirname(filename),\n                dotfiles: 'deny',\n                headers: {\n                    'x-timestamp': Date.now(),\n                    'x-sent': true\n                }\n              };\n\n              res.sendFile(filename);\n            });\n        });\n    });\n\n};"]}